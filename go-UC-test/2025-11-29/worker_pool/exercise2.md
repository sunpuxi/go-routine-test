# 练习2：带超时和错误处理的 Worker Pool（困难）

## 题目描述

实现一个增强版的 Worker Pool，支持超时控制和错误处理。

## 需求

1. **基础 Worker Pool**：
   - Worker 数量可配置（例如 4 个）
   - 从任务 channel 取任务并处理

2. **任务结构**：
   ```go
   type Task struct {
       ID      int
       Timeout time.Duration  // 该任务的超时时间（随机 50ms-500ms）
   }
   ```

3. **任务处理逻辑**：
   - 每个任务需要模拟耗时（使用 `time.Sleep(task.Timeout)`）
   - 如果任务 ID 是偶数，模拟可能失败（30% 概率失败）
   - 失败时返回错误，成功时返回结果 `task.ID * task.ID`

4. **超时控制**：
   - 每个任务有独立的超时时间
   - 如果任务处理超时，应该取消任务并返回超时错误
   - 使用 `context.WithTimeout` 实现

5. **结果结构**：
   ```go
   type Result struct {
       TaskID  int
       Value   int      // 成功时的结果值
       Error   error    // 失败时的错误信息
       Cost    time.Duration  // 实际耗时
   }
   ```

6. **统计信息**：
   - 统计成功任务数、失败任务数、超时任务数
   - 统计总耗时、平均耗时

7. **任务生成**：
   - 生成 20 个任务，每个任务的超时时间随机（50ms-500ms）
   - 偶数 ID 的任务有 30% 概率失败（使用随机数模拟）

## 输入输出示例

```
=== Worker Pool 启动 ===
Worker 数量: 4
任务数量: 20

Worker 0: 开始处理任务 0 (超时: 200ms)
Worker 1: 开始处理任务 1 (超时: 150ms)
Worker 2: 开始处理任务 2 (超时: 300ms)
Worker 3: 开始处理任务 3 (超时: 100ms)
Worker 0: 任务 0 失败: 模拟错误
Worker 1: 任务 1 完成，结果 = 1 (耗时: 150ms)
Worker 3: 任务 3 完成，结果 = 9 (耗时: 100ms)
...

=== 统计结果 ===
总任务数: 20
成功: 15
失败: 3
超时: 2
总耗时: 1.2s
平均耗时: 60ms
```

## 评分标准

- ✅ 正确实现 Worker Pool 模式（15分）
- ✅ 正确使用 context 实现超时控制（20分）
- ✅ 正确处理任务失败和超时（20分）
- ✅ 正确关闭 channel，无死锁（15分）
- ✅ 正确统计和输出结果（15分）
- ✅ 代码结构清晰，错误处理完善（15分）

## 提示

- 使用 `context.WithTimeout` 为每个任务设置超时
- 使用 `math/rand` 生成随机数和模拟失败
- 注意：任务处理函数需要检查 context 是否被取消
- 统计信息在主 goroutine 收集完所有结果后计算

## 额外挑战（可选）

- 实现任务重试机制（失败的任务重试 1 次）
- 实现动态调整 Worker 数量（根据任务队列长度）

