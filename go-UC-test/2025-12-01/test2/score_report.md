# ç»ƒä¹ 2 è¯„åˆ†æŠ¥å‘Š

## æ€»åˆ†ï¼š100/100 âœ…

---

## è¯¦ç»†è¯„åˆ†

### 1. æ‰‡å…¥æ¨¡å¼å®ç°æ­£ç¡®æ€§ï¼ˆ40/40ï¼‰âœ…

**ä¼˜ç‚¹**ï¼š
- âœ… æ­£ç¡®ä½¿ç”¨ goroutine å¹¶å‘å¤„ç†æ¯ä¸ª input channel
- âœ… æ¯ä¸ª goroutine ä» input è¯»å–æ•°æ®å¹¶å‘é€åˆ° output
- âœ… çœŸæ­£å®ç°äº†"æ‰‡å…¥"ï¼šå¤šä¸ª channel å¹¶å‘åˆå¹¶

**ä»£ç ç‰‡æ®µ**ï¼š
```go
for _, in := range inputs {
    wg.Add(1)
    go func(ch <-chan int) {
        defer wg.Done()
        for v := range ch {
            output <- v
        }
    }(in)
}
```
âœ… å®Œå…¨æ­£ç¡®

**å…³é”®ç‚¹**ï¼š
- ä½¿ç”¨ `go func(ch <-chan int)` å¹¶å‘å¤„ç†
- æ­£ç¡®ä¼ é€’å‚æ•° `(in)` é¿å…é—­åŒ…å˜é‡æ•è·é—®é¢˜
- ä½¿ç”¨ `for range ch` è¯»å–æ•°æ®

---

### 2. WaitGroup ä½¿ç”¨ï¼ˆ25/25ï¼‰âœ…

**ä¼˜ç‚¹**ï¼š
- âœ… æ­£ç¡®ä½¿ç”¨ `wg.Add(1)` å¢åŠ è®¡æ•°å™¨
- âœ… æ­£ç¡®ä½¿ç”¨ `defer wg.Done()` å‡å°‘è®¡æ•°å™¨
- âœ… æ­£ç¡®ä½¿ç”¨å•ç‹¬çš„ goroutine æ‰§è¡Œ `wg.Wait()` å¹¶å…³é—­ output

**ä»£ç ç‰‡æ®µ**ï¼š
```go
go func() {
    wg.Wait()
    close(output)
}()
```
âœ… å®Œå…¨æ­£ç¡®

**ä¸ºä»€ä¹ˆéœ€è¦å•ç‹¬çš„ goroutineï¼Ÿ**
- å¦‚æœä¸» goroutine ç›´æ¥ `wg.Wait()`ï¼Œä¼šé˜»å¡ï¼Œæ— æ³•è¿”å› output
- ä½¿ç”¨å•ç‹¬çš„ goroutine ç­‰å¾…ï¼Œä¸» goroutine å¯ä»¥ç«‹å³è¿”å›
- è¿™æ ·ä¸» goroutine å¯ä»¥ç«‹å³å¼€å§‹æ¥æ”¶æ•°æ®ï¼Œä¸ä¼šæ­»é”

---

### 3. Channel å…³é—­é€»è¾‘ï¼ˆ20/20ï¼‰âœ…

**ä¼˜ç‚¹**ï¼š
- âœ… æ­£ç¡®å…³é—­ output channel
- âœ… åœ¨æ‰€æœ‰ goroutine å®Œæˆåå†å…³é—­ï¼ˆä½¿ç”¨ `wg.Wait()`ï¼‰
- âœ… å…³é—­æ—¶æœºæ­£ç¡®ï¼šä¸ä¼šè¿‡æ—©å…³é—­ï¼Œä¹Ÿä¸ä¼šå¿˜è®°å…³é—­

**ä»£ç ç‰‡æ®µ**ï¼š
```go
go func() {
    wg.Wait()        // ç­‰å¾…æ‰€æœ‰è¾“å…¥å®Œæˆ
    close(output)    // ç„¶åå…³é—­ output
}()
```
âœ… å®Œå…¨æ­£ç¡®

---

### 4. ä»£ç ç»“æ„å’Œé€»è¾‘ï¼ˆ15/15ï¼‰âœ…

**ä¼˜ç‚¹**ï¼š
- âœ… ä»£ç ç»“æ„æ¸…æ™°
- âœ… å˜é‡å‘½ååˆç†ï¼ˆ`in`, `ch`, `v`ï¼‰
- âœ… æ³¨é‡Šæ¸…æ™°ï¼Œè¯´æ˜äº†å…³é”®é€»è¾‘
- âœ… å‡½æ•°èŒè´£å•ä¸€

**ä»£ç ç‰‡æ®µ**ï¼š
```go
// å¹¶å‘å¤„ç†æ¯ä¸ªè¾“å…¥channel
for _, in := range inputs {
    // ...
}

// ç­‰å¾…æ‰€æœ‰goroutineå®Œæˆï¼Œç„¶åå…³é—­è¾“å‡ºchannel
go func() {
    // ...
}()

// æå‰è¿”å›è¾“å‡ºchannelï¼Œè®©è°ƒç”¨è€…å¯ä»¥ç«‹å³ä½¿ç”¨
return output
```
âœ… æ³¨é‡Šæ¸…æ™°ï¼Œé€»è¾‘æ˜ç¡®

---

## ä»£ç äº®ç‚¹

### 1. æ­£ç¡®çš„å¹¶å‘å¤„ç†

```go
for _, in := range inputs {
    wg.Add(1)
    go func(ch <-chan int) {  // âœ… å¹¶å‘å¤„ç†
        defer wg.Done()
        for v := range ch {
            output <- v
        }
    }(in)  // âœ… æ­£ç¡®ä¼ é€’å‚æ•°
}
```

**å…³é”®ç‚¹**ï¼š
- ä¸ºæ¯ä¸ª input å¯åŠ¨ç‹¬ç«‹çš„ goroutine
- çœŸæ­£å®ç°äº†"æ‰‡å…¥"ï¼šå¤šä¸ª channel åŒæ—¶å¤„ç†
- é¿å…äº†é—­åŒ…å˜é‡æ•è·é—®é¢˜

### 2. æ­£ç¡®çš„å…³é—­æ—¶æœº

```go
go func() {
    wg.Wait()      // âœ… ç­‰å¾…æ‰€æœ‰è¾“å…¥å®Œæˆ
    close(output)  // âœ… ç„¶åå…³é—­
}()
```

**å…³é”®ç‚¹**ï¼š
- ä½¿ç”¨å•ç‹¬çš„ goroutine ç­‰å¾…ï¼Œä¸é˜»å¡ä¸»æµç¨‹
- ç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½å‘é€å®Œåå†å…³é—­
- ä¸» goroutine å¯ä»¥ç«‹å³è¿”å›å¹¶å¼€å§‹æ¥æ”¶

### 3. æ— æ­»é”è®¾è®¡

```go
return output  // âœ… ç«‹å³è¿”å›

// ä¸» goroutine ç«‹å³å¼€å§‹æ¥æ”¶
for value := range merged {
    // æ¥æ”¶æ•°æ®
}
```

**å…³é”®ç‚¹**ï¼š
- `fanIn` ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…æ•°æ®å‘é€
- ä¸» goroutine ç«‹å³å¼€å§‹æ¥æ”¶
- å½¢æˆ"ç”Ÿäº§è€…-æ¶ˆè´¹è€…"æ¨¡å¼ï¼Œä¸ä¼šæ­»é”

---

## æ‰§è¡Œæµç¨‹åˆ†æ

### æ­£ç¡®çš„æ‰§è¡Œæµç¨‹

```
T1: ä¸» goroutine è°ƒç”¨ fanIn(ch1, ch2, ch3)
T2: fanIn åˆ›å»º output channel
T3: fanIn å¯åŠ¨ 3 ä¸ª goroutineï¼ˆå¹¶å‘å¤„ç† ch1, ch2, ch3ï¼‰
T4: fanIn å¯åŠ¨ 1 ä¸ª goroutineï¼ˆç­‰å¾…å¹¶å…³é—­ï¼‰
T5: fanIn ç«‹å³è¿”å› output
T6: ä¸» goroutine å¼€å§‹ä» merged æ¥æ”¶æ•°æ®
T7: 3 ä¸ª goroutine å¹¶å‘å‘é€æ•°æ®åˆ° output
T8: ä¸» goroutine æ¥æ”¶æ•°æ®ï¼ˆä¸ä¼šé˜»å¡ï¼‰
T9: æ‰€æœ‰æ•°æ®æ¥æ”¶å®Œæˆ
T10: ç­‰å¾… goroutine çš„ wg.Wait() è¿”å›
T11: å…³é—­ output
T12: ä¸» goroutine çš„ for range é€€å‡º
```

âœ… æµç¨‹å®Œå…¨æ­£ç¡®ï¼Œæ— æ­»é”é£é™©

---

## é¢„æœŸè¿è¡Œç»“æœ

```
=== ç»ƒä¹ 2ï¼šæ‰‡å…¥æ¨¡å¼ï¼ˆFan-Inï¼‰===

æ¥æ”¶åˆå¹¶åçš„æ•°æ®ï¼š
æ”¶åˆ°: 1
æ”¶åˆ°: 6
æ”¶åˆ°: 11
æ”¶åˆ°: 2
æ”¶åˆ°: 7
æ”¶åˆ°: 12
...
Channel 1 å®Œæˆ
Channel 2 å®Œæˆ
Channel 3 å®Œæˆ
æ‰€æœ‰æ•°æ®æ¥æ”¶å®Œæˆ
```

**è¯´æ˜**ï¼š
- æ•°æ®é¡ºåºå¯èƒ½æ˜¯ä¹±åºçš„ï¼ˆå› ä¸ºå¹¶å‘å¤„ç†ï¼‰
- æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«æ­£ç¡®æ¥æ”¶
- ä¸ä¼šæ­»é”

---

## çŸ¥è¯†ç‚¹æŒæ¡æƒ…å†µ

### âœ… ä½ æŒæ¡çš„å†…å®¹

1. **æ‰‡å…¥æ¨¡å¼ï¼ˆFan-Inï¼‰**ï¼š
   - ç†è§£å¤šä¸ª channel å¹¶å‘åˆå¹¶çš„æ¦‚å¿µ
   - æ­£ç¡®ä½¿ç”¨ goroutine å®ç°å¹¶å‘å¤„ç†

2. **WaitGroup ä½¿ç”¨**ï¼š
   - æ­£ç¡®ä½¿ç”¨ `Add()`ã€`Done()`ã€`Wait()`
   - ç†è§£åœ¨å•ç‹¬ goroutine ä¸­ç­‰å¾…çš„é‡è¦æ€§

3. **Channel å…³é—­**ï¼š
   - ç†è§£å…³é—­æ—¶æœºï¼šæ‰€æœ‰æ•°æ®å‘é€å®Œåå†å…³é—­
   - ç†è§£å…³é—­çš„å¿…è¦æ€§ï¼šè®© `for range` èƒ½å¤Ÿé€€å‡º

4. **å¹¶å‘å®‰å…¨**ï¼š
   - ç†è§£å¦‚ä½•é¿å…æ­»é”
   - ç†è§£"ç”Ÿäº§è€…-æ¶ˆè´¹è€…"æ¨¡å¼

---

## æ€»ç»“

**æ€»ä½“è¯„ä»·**ï¼šâ­â­â­â­â­

**ä¼˜ç‚¹**ï¼š
- âœ… æ‰‡å…¥æ¨¡å¼å®ç°å®Œå…¨æ­£ç¡®
- âœ… å¹¶å‘å¤„ç†é€»è¾‘æ­£ç¡®
- âœ… WaitGroup ä½¿ç”¨æ­£ç¡®
- âœ… Channel å…³é—­é€»è¾‘æ­£ç¡®
- âœ… æ— æ­»é”é£é™©
- âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ³¨é‡Šåˆç†

**æ ¸å¿ƒçŸ¥è¯†ç‚¹æŒæ¡æƒ…å†µ**ï¼š
- âœ… ç†è§£æ‰‡å…¥æ¨¡å¼çš„æ¦‚å¿µå’Œå®ç°
- âœ… ç†è§£å¹¶å‘å¤„ç†å¤šä¸ª channel çš„æ–¹æ³•
- âœ… ç†è§£å¦‚ä½•æ­£ç¡®å…³é—­ channel
- âœ… ç†è§£å¦‚ä½•é¿å…æ­»é”

**å¯ä»¥ç»§ç»­å­¦ä¹ **ï¼š
- ç»ƒä¹ 3ï¼šç®¡é“æ¨¡å¼ï¼ˆPipelineï¼‰

---

**æ­å–œå®Œæˆç»ƒä¹ 2ï¼** ğŸ‰

ä»£ç å®ç°å®Œç¾ï¼Œæ‰€æœ‰è¦æ±‚éƒ½è¾¾åˆ°äº†ï¼è¿™æ˜¯æ ‡å‡†çš„æ‰‡å…¥æ¨¡å¼å®ç°ã€‚

